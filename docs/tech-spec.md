# 🧪 技術要件仕様書（Phase 1）

このドキュメントでは、楽器練習用音楽プレイヤーのPhase 1における使用技術・構成・保存戦略などの技術要件を整理します。

---

## ✅ 使用技術スタック

| 項目      | 技術                        | 備考                         |
| ------- | ------------------------- | -------------------------- |
| フレームワーク | Next.js 14系（App Router）   | PWA対応、App Routerでモダンな構成    |
| UI構築    | React + Tailwind CSS      | デザインの一貫性と開発効率を重視           |
| 音源描画・再生 | WaveSurfer.js             | 複数トラック波形表示／Region／Marker対応 |
| 状態管理    | useState / useReducer（暫定） | 状況に応じてZustandなどへ切替検討       |
| デプロイ環境  | Vercel                    | PWA展開と相性良好                 |

---

## 📦 PWA対応

| 項目            | 技術                     | 備考                         |
| ------------- | ---------------------- | -------------------------- |
| PWA構成         | next-pwa               | manifest・SW自動構成            |
| manifest.json | `public/manifest.json` | アプリアイコン、名前、表示モードなど         |
| オフライン対応       | Workbox + IndexedDB    | HTML/CSS/JSと音源ファイルをキャッシュ保存 |

---

## 🎧 音源ファイル対応

| フォーマット | 対応      | 備考                              |
| ------ | ------- | ------------------------------- |
| mp3    | ✅       | 標準サポート（全ブラウザ）                   |
| wav    | ✅       | 標準サポート                          |
| flac   | 🔶 条件付き | Chrome系対応、Safari不可（非対応ブラウザでは警告） |

* ブラウザ再生互換性を考慮し、非対応形式はアップロード制限または警告表示

---

## 💾 保存方式

| 対象           | 手段                  | 備考                         |
| ------------ | ------------------- | -------------------------- |
| プレイリスト構成・設定  | localStorage        | 軽量・シンプルな保存用途に使用            |
| 音源ファイル（バイナリ） | IndexedDB + idb     | Blob形式で保存。オフライン再利用可        |
| 再生URL生成      | URL.createObjectURL | IndexedDBから取り出したBlobから動的生成 |

---

## 🔄 ネイティブアプリ化に向けた前提（Phase 2以降）

| 対象     | 技術                  | 備考                                  |
| ------ | ------------------- | ----------------------------------- |
| ネイティブ化 | React Native + Expo | ロジック・UI構造を再利用予定                     |
| ストレージ  | AsyncStorage        | WebのlocalStorage/IndexedDBとの互換性設計検討 |
| 再生エンジン | Expo AV             | ネイティブ再生機能に置き換え予定                    |

---

以上がPhase 1における技術的構成と仕様の全体像です。
